# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
    - master

pr:
  branches:
    include:
    - master

variables:
  majorVersion: 1
  minorVersion: 0

name: $(majorVersion).$(minorVersion).$(Rev:r)

jobs:
- job: Build
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - script: dotnet build
    displayName: 'dotnet build'

- job: Publish
  dependsOn: Build
  confition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - task: DotNetCoreCLI@2
    displayName: 'dotnet pack'
    inputs:
      command: 'pack'
      configuration: 'release'
      packagesToPack: 'LiquidState/*.csproj'
      verbosityPack: 'normal'
      versioningScheme: byPrereleaseNumber

  - task: PublishBuildArtifacts@1
    displayName: 'publish build artifacts'
    inputs:
      artifactName: 'Packages'
